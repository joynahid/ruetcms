{% extends 'defaults/authlayout.html' %}
{% block title %} Performance Monitoring {%endblock%}
{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
    <i class="fas fa-info-circle"></i> {{ message }}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
{% endfor %}
{% endif %}
{% endwith %}
<div class="card bg-white rounded shadow-sm">
    <div class="card-body p-5">
        <h5 class="card-title">
            Performance Checker (Codeforces Only)
        </h5>


        <form id='contestids'>
            <div class="form-group">
                <div class="form-group">
                    <label for="cfid" class="col-form-label">Contest Number</label>
                    <div class="col-sm-8 p-0">
                        <input type="text" class="form-control" id="cfid" placeholder="1303">
                    </div>
                </div>
        </form>

        <table class="table shadow-sm table-bordered" id="mainlist">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Username</th>
                    <th scope="col">Capability</th>
                    <th scope="col">Estimated Time</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <!-- <div id="Result"></div>

        <div class="mt-5">
            <a href="#" id="triggerData" class="card-link"><i class="fas fa-file-pdf pr-2"></i> Get PDF</a>
        </div>
        <hr>
        <div class="mt-2">
            <a href="{{request.referrer}}" class="card-link"><i class="fas fa-arrow-left pr-2"></i> Generate Again</a>
        </div> -->
    </div>
</div>
</div>

{%endblock%}
{%block script%}

<script type="text/javascript">
    $(document).ready(function () {

        $('#mainlist').find('tbody').append("<td colspan=4 class='bg-light'><center>No Data to Show</center></td>");

        $("form").submit(function (e) {

            e.preventDefault();

            cid = $('input:first').val()

            $.ajax({
                type: "GET",
                url: "{{url_for('performance')}}" + '?contestid=' + cid,
                data: 'data',
                success: function (data) {
                    $('#mainlist').find('tbody').empty();
                    $('#mainlist').find('tbody').hide();
                    var cnt = 1;
                    $.each(data, function (key, element) {
                        var htm = "<tr><td>" + cnt++ + "</td><td>" + element.id + "</td> <td>" + element.capability.toFixed(2) + "%</td><td>" + element.time.toFixed(2) + " minutes</td></tr>";
                        $('#mainlist').find('tbody').append(htm);
                    });

                    $('#mainlist').find('tbody').fadeIn();
                },
                error: function (xmlHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        });
    });
</script>
{%endblock%}